<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Prompt Weight Mixer</title>
<script>
(function () {
  var theme = "dark";
  try {
    var stored = localStorage.getItem("prompt_mixer_theme");
    if (stored === "light" || stored === "dark") theme = stored;
  } catch (_) {}
  document.documentElement.setAttribute("data-theme", theme);
})();
</script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #0b0b13;
  --surface:  #11111c;
  --surface2: #181828;
  --border:   #1e1e32;
  --border2:  #2a2a45;
  --muted:    #484868;
  --text:     #c4c4de;
  --heading:  #e4e4f8;
  --accent:   #7c5cfc;
  --green:    #22c55e;
  --gold:     #d97706;
}

[data-theme="light"] {
  --bg:       #f5f7fb;
  --surface:  #eef2fa;
  --surface2: #e7ecf7;
  --border:   #cad4e8;
  --border2:  #b8c5df;
  --muted:    #60708d;
  --text:     #23314b;
  --heading:  #1c2941;
  --accent:   #4c66c7;
  --green:    #0f8a43;
  --gold:     #b56d0a;
}

html, body {
  min-height: 100vh;
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}

.menu-wrap {
  max-width: 680px;
  margin: 0 auto;
  padding: 40px 24px;
}

.cards {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 26px;
}

.card {
  flex: 1 1 200px;
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: 14px;
  padding: 32px 28px;
  text-decoration: none;
  color: inherit;
  transition: border-color 0.2s, transform 0.15s, box-shadow 0.2s;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.card:hover {
  border-color: var(--accent);
  transform: translateY(-3px);
  box-shadow: 0 8px 32px rgba(124,92,252,0.12);
}

.card-icon {
  font-size: 32px;
  opacity: 0.7;
}

.card-name {
  font-size: 17px;
  font-weight: 700;
  color: var(--heading);
}

.card-desc {
  font-size: 12px;
  color: var(--muted);
  line-height: 1.7;
}

.card-arrow {
  margin-top: auto;
  padding-top: 8px;
  font-size: 11px;
  color: var(--accent);
  font-weight: 600;
  letter-spacing: 1px;
}

.stat-card {
  border-style: dashed;
}

.stat-card .card-name {
  color: var(--green);
}

.fish-count {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

@media (max-width: 720px) {
  .cards { flex-direction: column; }
}
</style>
</head>
<body>
<div class="menu-wrap">
  <div class="cards">

    <a class="card" href="paragraph-adapter-feedback.html">
      <div class="card-icon">&#129504;</div>
      <div class="card-name">PthinkTank</div>
      <div class="card-desc">
        Fishy wishy spatial prompt mixing.
      </div>
      <div class="card-arrow">Open &rarr;</div>
    </a>

    <a class="card" href="settings.html">
      <div class="card-icon">&#9881;</div>
      <div class="card-name">Configuration</div>
      <div class="card-desc">
        Tune default behavior, physics, cadence limits, and related settings.
        API keys are managed here and saved to <code>.env</code>.
      </div>
      <div class="card-arrow">Open &rarr;</div>
    </a>

    <div class="card stat-card" aria-live="polite">
      <div class="card-icon">&#128031;</div>
      <div class="card-name">Fed <span class="fish-count" id="fedFishCount">000</span> Fish so far</div>
      <div class="card-desc">
        Total API calls made by this system, persisted server-side.
      </div>
      <div class="card-arrow" id="fedFishStatus">Loading...</div>
    </div>

  </div>
</div>
<script>
function applyTheme(theme) {
  const safeTheme = (theme === "light") ? "light" : "dark";
  document.documentElement.setAttribute("data-theme", safeTheme);
}

async function loadTheme() {
  try {
    const stored = localStorage.getItem("prompt_mixer_theme");
    if (stored === "light" || stored === "dark") {
      applyTheme(stored);
      return;
    }
  } catch (_) {}

  try {
    const res = await fetch("/api/app-config");
    if (!res.ok) throw new Error("app-config request failed");
    const data = await res.json();
    const fromConfig = data && data.config && data.config.default_theme;
    applyTheme(fromConfig);
  } catch (_) {
    applyTheme("dark");
  }
}

async function loadFishCount() {
  const countEl = document.getElementById("fedFishCount");
  const statusEl = document.getElementById("fedFishStatus");
  if (!countEl || !statusEl) return;

  try {
    const res = await fetch("/api/stats");
    if (!res.ok) throw new Error("stats request failed");
    const data = await res.json();
    const total = Number.isFinite(Number(data.total_api_calls)) ? Math.max(0, Number(data.total_api_calls)) : 0;
    countEl.textContent = String(Math.floor(total)).padStart(3, "0");
    statusEl.textContent = "Live";
  } catch (_) {
    statusEl.textContent = "Unavailable";
  }
}

loadTheme();
loadFishCount();
</script>
<footer style="display:flex;justify-content:center;padding:12px 0 18px;">
  <a href="https://designresearch.works/" target="_blank" rel="noopener noreferrer" aria-label="Design Research Works" style="display:inline-flex;align-items:center;gap:8px;color:var(--muted);text-decoration:none;">
    <img src="logo.png" alt="Design Research Works logo" style="width:34px;height:34px;display:block;" />
  </a>
</footer>
</body>
</html>
